<!DOCTYPE html>
<html>
  <head>
    <title>日本地図カルトグラム</title>
    <meta charset="utf-8">
    <meta property="og:image" content="placeholder.png">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7V4DZP7MTB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-7V4DZP7MTB');
    </script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/style.css">
  </head>
  <body>
    <main class="page container-fluid">
      <section class="card hero-card">
        <h1>日本地図カルトグラム</h1>
        <p>
          都道府県別データを CSV でアップロードして、面積をデータ値に比例させたカルトグラムをブラウザだけで生成できます。
        </p>
      </section>

      <div class="layout">
        <section class="card data-panel">
          <div class="panel-header">
            <h2>データ管理</h2>
            <p>
              CSV の「都道府県」列をキーとして利用し、他の列を指標として利用します。アップロード後に内容を確認してからマップに適用できます。
            </p>
          </div>

          <div class="field-group">
            <h3>現在の適用データ</h3>
            <div class="current-status">
              <span class="status-label">状態</span>
              <span class="status-value" id="current-data-label">サンプルデータ</span>
            </div>
            <button class="btn btn-tertiary" id="toggle-current-preview" type="button">
              表データを隠す
            </button>
            <div id="current-data-preview" class="data-preview"></div>
          </div>

          <ul class="nav nav-tabs nav-fill data-tabs" id="data-tabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="sample-tab" data-bs-toggle="pill" data-bs-target="#sample-pane" type="button" role="tab" aria-controls="sample-pane" aria-selected="true">サンプル</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="upload-tab" data-bs-toggle="pill" data-bs-target="#upload-pane" type="button" role="tab" aria-controls="upload-pane" aria-selected="false">オリジナル</button>
            </li>
          </ul>

          <div class="tab-content" id="data-tab-content">
            <div class="tab-pane fade show active" id="sample-pane" role="tabpanel" aria-labelledby="sample-tab">
            <div class="field-group">
              <h3>サンプルデータ</h3>
              <p class="info-note">
                初期表示ではサンプルデータ（SSDSE-C の米／食パン支出）を読み込んでいます。
              </p>
              <div class="button-row wrap">
                <a class="btn btn-secondary" id="download-sample" href="data/theme.csv" download>ダウンロード</a>
                <button class="btn btn-tertiary" id="reset-data" type="button">サンプルに戻す</button>
              </div>
            </div>
            </div>

            <div class="tab-pane fade" id="upload-pane" role="tabpanel" aria-labelledby="upload-tab">
              <div class="field-group">
                <h3>データアップロード</h3>
                <div id="dropzone" class="upload-area">
                  <p class="title">CSV をドラッグ＆ドロップ</p>
                  <p>または</p>
                  <label class="file-input-label btn btn-secondary">
                    <input type="file" id="file-input" accept=".csv,text/csv">
                    ファイルを選択
                  </label>
                </div>
                <p id="upload-status" class="help-text"></p>
              </div>

              <div id="preview" class="field-group">
                <div class="section-header">
                  <h3>アップロードプレビュー</h3>
                </div>
                <div id="preview-table" class="table-container"></div>
                <div id="preview-stats" class="preview-stats"></div>
                <button class="btn btn-primary full-width" id="apply-data" type="button" disabled>
                  このデータを適用
                </button>
              </div>
            </div>
          </div>
        </section>

        <section class="card map-card" id="map-card">
          <div class="map-card-header">
            <div class="map-heading">
              <h2>地図プレビュー</h2>
              <span id="status" class="status-pill"></span>
            </div>
            <div class="map-select">
              <select id="field" aria-label="データ指標"></select>
              <select id="color-scheme" aria-label="カラースキーム"></select>
            </div>
          </div>
          <div id="map-container" class="map-frame">
            <svg id="map" viewBox="0 0 800 800" preserveAspectRatio="xMidYMid meet"></svg>
          </div>
          <div class="button-row stretch download-row">
            <button class="btn btn-secondary" id="download-svg-btn" type="button">SVGダウンロード</button>
            <button class="btn btn-secondary" id="download-png-btn" type="button">PNGダウンロード</button>
          </div>
        </section>
      </div>
    </main>
    <footer class="footer-links">
      <div class="links-container">
        <a href="https://www.dataviz.jp/" target="_blank" rel="noreferrer noopener">dataviz.jp</a>
        <span class="divider">|</span>
        <a href="https://visualizing.jp/" target="_blank" rel="noreferrer noopener">Visualizing.JP</a>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/topojson.v2.min.js"></script>
    <script src="assets/d3-legend.min.js"></script>
    <script src="assets/topogram.js"></script>
    <script src="assets/main.js"></script>
  </body>
</html>
